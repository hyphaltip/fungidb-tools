mkdir $PROJECT_HOME/ApiCommonWebsite/View/lib/perl/GraphPackage/FungiDB/CimmRS
touch $PROJECT_HOME/ApiCommonWebsite/View/lib/perl/GraphPackage/FungiDB/CimmRS/CimmComTranRnaSeq.pm
#< $PROJECT_HOME/ApiCommonWebsite/View/lib/perl/GraphPackage/FungiDB/CimmRS/CimmComTranRnaSeq.pm

package ApiCommonWebsite::View::GraphPackage::FungiDB::CimmRS::CimmComTranRnaSeq;

use strict;
use vars qw( @ISA );

@ISA = qw( ApiCommonWebsite::View::GraphPackage::SimpleRNASeq );
use ApiCommonWebsite::View::GraphPackage::SimpleRNASeq;


sub init {
  my $self = shift;

  $self->SUPER::init(@_);

  #$self->setPlotWidth(800);
  #$self->setBottomMarginSize(7);

  $self->setAdditionalRCode("colnames(profile.df) =  sub(\".fastq\", \"\", colnames(profile.df));");
  $self->setMinRpkmProfileSet("C immitis saprobic hyphae and parasitic spherules");
  $self->setDiffRpkmProfileSet("C immitis saprobic hyphae and parasitic spherules-diff");
  $self->setPctProfileSet("percentile - C immitis saprobic hyphae and parasitic spherules");
  $self->setColor("#29ACF2");
  $self->makeGraphs(@_);

  return $self;
}


1;


#< $PROJECT_HOME/ApiCommonShared/Model/lib/wdk/apiCommonModel/records/geneRecord.xml

                <textAttribute name="CimmComTranRnaSeq_graph"
                    displayName="C. immitis RNASeq - Graph"
                    attributeCategory="trasexpr"
                    inReportMaker="false" truncateTo="100000" sortable="false"
                    includeProjects="FungiDB">
                    <text>
                        <![CDATA[
                        <img src="/cgi-bin/dataPlotter.pl?type=CimmRS::CimmComTranRnaSeq&project_id=FungiDB&fmt=png&id=$$primary_key$$&thumb=1&vp=coverage"/>
                        ]]>
                    </text>
                </textAttribute>


#< $PROJECT_HOME/ApiCommonShared/Model/lib/wdk/apiCommonModel/questions/params/geneParams.xml

        <sqlQuery name="CimmComTranRnaSeqProfiles" includeProjects="FungiDB">
            <column name="display"/>
            <column name="internal"/>
            <column name="term"/>
            <sql>
                Select name as term,
                profile_set_id as internal,
                'Comparative Transcriptomics' as display
                from apidb.profileset
                where name like 'C immitis saprobic hyphae and parasitic spherules'
            </sql>
        </sqlQuery>

        <sqlQuery name="CimmComTranRnaSeqPercentiles" includeProjects="FungiDB">
            <column name="display"/>
            <column name="internal"/>
            <column name="term"/>
            <sql>
                Select name as term,
                profile_set_id as internal,
                'Comparative Transcriptomics' as display
                from apidb.profileset
                where name like 'percentile - C immitis saprobic hyphae and parasitic spherules'
            </sql>
        </sqlQuery>


#< $PROJECT_HOME/ApiCommonShared/Model/lib/wdk/apiCommonModel/questions/geneQuestions.xml

    <question name="GenesByRnaSeqFoldChangeCimmComTran" includeProjects="FungiDB"
        displayName="Cimm Comparative Transcriptomics Rna Seq (fold change)"
        shortDisplayName="Cimm RNASeq fc"
        searchCategory="Transcript Expression"
        queryRef="GeneId.GenesByGenericFoldChange"
        recordClassRef="GeneRecordClasses.GeneRecordClass">

        <attributesList
            summary="organism,product,fold_change_chosen,chose_group_two,chose_group_one,CimmComTranRnaSeq_graph"/>

        <paramRef ref="geneParams.profileset_generic" queryRef="GeneVQ.CimmComTranRnaSeqProfiles"/>
        <paramRef ref="geneParams.global_min_max" visible="false"/>
        <sqlParamValue name="isLogged">0</sqlParamValue>
        <sqlParamValue name="shift">1</sqlParamValue>

        <summary>
            <![CDATA[
            Identify <i>Coccidioides immitis</i> genes based on expression fold change.
            ]]>
        </summary>

        <description>
            <![CDATA[
            This study used comparative transcriptomics to identify gene expression differences between the saprobic and parasitic growth phases. They prepared Illumina mRNA sequencing libraries for saprobic-phase hyphae and parasitic-phase spherules in vitro for C. immitis isolate RS and C. posadasii isolate C735 in biological triplicate.
            ]]>
        </description>

        <dynamicAttributes>
            <columnAttribute name="fold_change_avg" displayName="Fold Change (Avg)" align="center"/>
            <columnAttribute name="fold_change_chosen" displayName="Fold Change" align="center"/>
            <columnAttribute name="avg_group_one" displayName="Avg Comp (log2)" align="center"/>
            <columnAttribute name="avg_group_two" displayName="Avg Ref (log2)" align="center"/>
            <columnAttribute name="min_group_one" displayName="Min Comp (log2)" align="center"/>
            <columnAttribute name="min_group_two" displayName="Min Ref (log2)" align="center"/>
            <columnAttribute name="max_group_one" displayName="Max Comp (log2)" align="center"/>
            <columnAttribute name="max_group_two" displayName="Max Ref (log2)" align="center"/>
            <columnAttribute name="chose_group_one" displayName="Chosen Comp (log2)" align="center"/>
            <columnAttribute name="chose_group_two" displayName="Chosen Ref (log2)" align="center"/>
            <columnAttribute name="time_of_min_expr" displayName="Time of Min Expression" align="center"/>
            <columnAttribute name="time_of_max_expr" displayName="Time of Max Expression" align="center"/>
        </dynamicAttributes>

        <propertyList name="specificAttribution">
            <value></value>
        </propertyList>
    </question>

    <question name="GenesByRnaSeqPercentileCimmComTran" includeProjects="FungiDB"
        displayName="Cimm Comparative Transcriptomics Rna Seq (percentile)"
        shortDisplayName="Cimm RNASeq fc"
        searchCategory="Transcript Expression"
        queryRef="GeneId.GenesByGenericPercentile"
        recordClassRef="GeneRecordClasses.GeneRecordClass">

        <paramRef ref="geneParams.profileset_generic" queryRef="GeneVQ.CimmComTranRnaSeqPercentiles"/>

        <attributesList
            summary="organism,product,min_percentile_chosen,max_percentile_chosen,CimmComTranRnaSeq_graph"
            sorting="percentile desc"
            />

        <summary>
            <![CDATA[
            Identify <i>Coccidioides immitis</i> genes based on expression fold change.
            ]]>
        </summary>


        <description>
            <![CDATA[
            This study used comparative transcriptomics to identify gene expression differences between the saprobic and parasitic growth phases. They prepared Illumina mRNA sequencing libraries for saprobic-phase hyphae and parasitic-phase spherules in vitro for C. immitis isolate RS and C. posadasii isolate C735 in biological triplicate.
            ]]>
        </description>


        <dynamicAttributes>
            <columnAttribute name="min_percentile_chosen" displayName="Min %ile (Within Chosen Samples)" align="center"/>
            <columnAttribute name="max_percentile_chosen" displayName="Max %ile (Within Chosen Samples)" align="center"/>
        </dynamicAttributes>

        <propertyList name="specificAttribution">
            <value></value>
        </propertyList>
    </question>


#< $PROJECT_HOME/ApiCommonShared/Model/lib/wdk/apiCommonModel/questions/categories.xml

            <questionRef includeProjects="FungiDB">GeneQuestions.GenesByRnaSeqFoldChangeCimmComTran</questionRef>
            <questionRef includeProjects="FungiDB">GeneQuestions.GenesByRnaSeqPercentileCimmComTran</questionRef>


#< $PROJECT_HOME/ApiCommonWebsite/Site/webapp/wdkCustomization/jsp/questions/InternalQuestions.GenesByRNASeqEvidence.form.jsp

Cimmstudy:Comparative Transcriptomics,GeneQuestions.GenesByRnaSeqFoldChangeCimmComTran,GeneQuestions.GenesByRnaSeqPercentileCimmComTran


#< $PROJECT_HOME/ApiCommonWebsite/Site/webapp/WEB-INF/tags/site/queryList.tag

<c:when test="${prefix == 'Cimm'}">
    <c:set var="org" value="Coccidioides immitis"/>
</c:when>


#< $PROJECT_HOME/ApiCommonWebsite/Site/conf/gbrowse.conf/fungidb.conf

[RnaSeqCimmComTran]
feature      = NextGenSeq:CimmRS_Taylor_ComparativeTranscriptomics_rnaSeq_RSRC
sqlName      = NextGenSeq:coverageLogSubtracks
sqlParam     = edname:'CimmRS_Taylor_ComparativeTranscriptomics_rnaSeq_RSRC'&&operator:=&&negativeValuesField:multiple&&subtrackField:is_reversed
category     = Transcript Expression Evidence: B. RNA-seq
glyph        = xyplot
graph_type   = boxes
bump density = 1
scale        = right
bgcolor      = blue
part_color   = sub { GBrowse::Display::colorByRnaSeq(shift,'blue') }
height       = 25
min_score    = -5
max_score    = 10
clip         = 1
label        = 0
subtrack select = Sample tag_value sample;
subtrack table  = :'Parasitic spherule' Spherules ;
                  :'Saprobic hyphae' Hyphae ;
key          = CimmRS mRNA RNASeq Taylor Comparative Transcriptomics
group_label  = 1
citation     = Emily Whiston et al (Taylor lab at UC Berkeley) Comparative Transcriptomics of the Saprobic and Parasitic Growth Phases in Coccidioides spp.


#< $PROJECT_HOME/ApiCommonShared/Model/lib/xml/gbrowseImageUrls.xml


    <track name="RnaSeqCimmComTran" />


#< $PROJECT_HOME/ApiCommonData/Load/lib/xml/tuningManager.xml

select 'C immitis saprobic hyphae and parasitic spherules' as profile_name,
       'CimmRS::CimmComTranRnaSeq' as module,
       'RNA Seq' as display_name,
       'This study used comparative transcriptomics to identify gene expression differences between the saprobic and parasitic growth phases. They prepared Illumina mRNA sequencing libraries for saprobic-phase hyphae and parasitic-phase spherules in vitro for C. immitis isolate RS and C. posadasii isolate C735 in biological triplicate.' as description,
       'Sample Time point (hours)' as x_axis,
       'log2 of the transcript levels of reads per kilobase of exon model per million mapped reads (RPKM).  Stacked bars indicate unique and non-uniquely mapped sequences.  Non-Unique sequences are plotted to indicate the maximum expression potential of this gene.
       ' as y_axis,
       10 as order_num,
       'TRUE' as mainOpen,
       'FALSE' as dataOpen,
       'coverage,percentile' as visible_parts,
       '' as dataTable,
       'expression' as type,
       '' as attribution
    from dual

    UNION


#<
bldw ApiCommonWebsite/Site $WWW/etc/webapp.prop
bld ApiCommonShared/Model
instance_manager manage FungiDB reload fungidb.edliaw
cd $HOME/GUS/gusApps
gusenv
tuningManager --instance fungbl3n --propFile $WWW/gus_home/config/tuningManagerProp.xml --doUpdate --tables 'ProfileGraphs,ProfileGraphDescrip' --configFile $WWW/project_home/ApiCommonData/Load/lib/xml/tuningManager.xml

